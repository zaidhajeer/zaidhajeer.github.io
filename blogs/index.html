<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Read the latest articles about web development, design, and technology">
    <title>Blog - Portfolio</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="blog-styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1>Portfolio</h1>
            <div class="nav-links">
                <a href="../index.html">Home</a>
                <a href="../index.html#about">About</a>
                <a href="../index.html#portfolio">Portfolio</a>
                <a href="#" class="active">Blogs</a>
                <a href="../index.html#contact">Contact</a>
            </div>
        </div>
    </nav>

    <section class="blog-section">
        <h1 class="section-title">Latest Posts</h1>
        
        <div class="blog-filters">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search posts...">
            </div>
            <div class="category-filters" id="categoryFilters">
                <!-- Categories will be added dynamically -->
            </div>
        </div>

        <div class="blog-grid" id="blogPosts">
            <div class="loading">Loading posts...</div>
        </div>

        <div class="pagination" id="pagination">
            <!-- Pagination will be added dynamically -->
        </div>
    </section>

    <script>
        const POSTS_PER_PAGE = 6;
        let allPosts = [];
        let currentPage = 1;
        let filteredPosts = [];

        async function loadBlogPosts() {
            try {
                const response = await fetch('https://api.github.com/repos/zaidhajeer/Portfolio/contents/blogs/posts');
                const files = await response.json();
                const blogGrid = document.getElementById('blogPosts');
                
                // Fetch and parse all posts
                allPosts = await Promise.all(
                    files
                        .filter(file => file.name.endsWith('.md'))
                        .map(async file => {
                            const content = await fetch(file.download_url).then(res => res.text());
                            const postData = parseFrontMatter(content);
                            if (postData) {
                                postData.slug = file.name.replace('.md', '');
                                return postData;
                            }
                        })
                );

                // Remove null values and sort by date
                allPosts = allPosts.filter(Boolean).sort((a, b) => new Date(b.date) - new Date(a.date));
                filteredPosts = [...allPosts];

                // Initialize filters
                initializeFilters();
                
                // Display first page
                displayPosts();

            } catch (error) {
                console.error('Error loading blog posts:', error);
                document.getElementById('blogPosts').innerHTML = 
                    '<div class="error">Error loading blog posts. Please try again later.</div>';
            }
        }

        function initializeFilters() {
            // Add search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(filterPosts, 300));

            // Add category filters
            const categories = [...new Set(allPosts.map(post => post.category))];
            const categoryFilters = document.getElementById('categoryFilters');
            categoryFilters.innerHTML = categories.map(category => `
                <button class="category-filter" data-category="${category}">${category}</button>
            `).join('');

            // Add category filter functionality
            categoryFilters.addEventListener('click', e => {
                if (e.target.classList.contains('category-filter')) {
                    e.target.classList.toggle('active');
                    filterPosts();
                }
            });
        }

        function filterPosts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeCategories = [...document.querySelectorAll('.category-filter.active')]
                .map(btn => btn.dataset.category);

            filteredPosts = allPosts.filter(post => {
                const matchesSearch = post.title.toLowerCase().includes(searchTerm) ||
                                   post.description.toLowerCase().includes(searchTerm);
                const matchesCategory = activeCategories.length === 0 || 
                                      activeCategories.includes(post.category);
                return matchesSearch && matchesCategory;
            });

            currentPage = 1;
            displayPosts();
        }

        function displayPosts() {
            const blogGrid = document.getElementById('blogPosts');
            const start = (currentPage - 1) * POSTS_PER_PAGE;
            const paginatedPosts = filteredPosts.slice(start, start + POSTS_PER_PAGE);

            if (paginatedPosts.length === 0) {
                blogGrid.innerHTML = '<div class="no-posts">No matching posts found.</div>';
                return;
            }

            blogGrid.innerHTML = paginatedPosts.map(post => `
                <article class="blog-card">
                    <div class="blog-image-container">
                        <img src="${post.image}" alt="${post.title}" class="blog-image" loading="lazy">
                        <div class="blog-category">${post.category}</div>
                    </div>
                    <div class="blog-content">
                        <div class="blog-meta">
                            <time datetime="${post.date}">${formatDate(post.date)}</time>
                            <span class="blog-author">By ${post.author}</span>
                        </div>
                        <h2 class="blog-title">${post.title}</h2>
                        <p class="blog-excerpt">${post.description}</p>
                        <a href="posts/${post.slug}.html" class="read-more">
                            Read More â†’
                        </a>
                    </div>
                </article>
            `).join('');

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredPosts.length / POSTS_PER_PAGE);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            pagination.innerHTML = `
                <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    Previous
                </button>
                <span class="page-info">${currentPage} of ${totalPages}</span>
                <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    Next
                </button>
            `;
        }

        function changePage(page) {
            currentPage = page;
            displayPosts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function parseFrontMatter(content) {
            try {
                const [_, frontMatter] = content.split('---');
                const data = {};
                frontMatter.trim().split('\n').forEach(line => {
                    const [key, ...values] = line.split(':');
                    if (key && values.length) {
                        data[key.trim()] = values.join(':').trim();
                    }
                });
                return data;
            } catch (error) {
                console.error('Error parsing front matter:', error);
                return null;
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        document.addEventListener('DOMContentLoaded', loadBlogPosts);
    </script>

    <footer>
        <p>&copy; 2024 Portfolio. All rights reserved.</p>
    </footer>
</body>
</html> 